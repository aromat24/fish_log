<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghoti - Hooked | Fishing Log</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @font-face {
        font-family: 'LucideIcons';
        /* Using unpkg CDN */
        src: url(https://cdn.jsdelivr.net/npm/lucide-static@latest/font/Lucide.ttf) format('truetype');
      }
      .lucide {
        font-family: 'LucideIcons';
        font-size: 1.25rem; /* Adjust icon size */
        line-height: 1;
        display: inline-block; /* Ensure proper alignment */
        vertical-align: middle; /* Align icon vertically */
      }
      /* Custom style for disabled button */
      .btn-disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      /* Hide elements by default */
      .hidden {
        display: none;
      }

      /* --- Landing Page Background --- */
      #landing-page {
        position: relative; /* Needed for the overlay */
        /*
          ***************************************************************
          * IMPORTANT: Placeholder image used for preview compatibility. *
          * *
          * TO USE YOUR IMAGE:                                          *
          * 1. Save your image (e.g., 'IMG-20160902-WA0002.jpg') in    *
          * the same folder as this HTML file.                       *
          * 2. Replace the line below with:                             *
          * background-image: url('IMG-20160902-WA0002.jpg');        *
          ***************************************************************
        */
        background-image: url('IMG-20160902-WA0002'); 
        background-size: cover; /* Cover the entire div */
        background-position: center; /* Center the image */
        color: white; /* Change default text color for better contrast */
        z-index: 1; /* Ensure content is above the pseudo-element */
      }

      /* Semi-transparent overlay for text readability */
      #landing-page::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5); /* Dark semi-transparent overlay */
        /* Match parent's rounded corners (rounded-xl = 0.75rem) */
        border-radius: 0.75rem;
        z-index: -1; /* Place overlay behind the content */
      }
      /* --- End Landing Page Background --- */

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script>
        // Tailwind config (works with @tailwindcss/browser)
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-sky-100 to-blue-200 font-sans min-h-screen flex items-center justify-center p-4">

    <div class="container mx-auto max-w-3xl bg-white rounded-xl shadow-lg overflow-hidden">

        <div id="landing-page" class="p-8 md:p-12 text-center relative">
             <div class="relative z-10">
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 flex items-center justify-center gap-3">
                    <span class="lucide text-3xl md:text-4xl"></span> Ghoti - Hooked
                </h1>
                <p class="text-lg text-gray-200 mb-8">Your simple, personal fishing log.</p>
                <p class="text-gray-300 mb-8">Keep track of your catches, locations, and notes all in one place. Your data is saved locally in your browser.</p>
                <button id="enter-app-btn" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    Enter Logbook
                </button>
            </div>
        </div>

        <div id="app-content" class="hidden p-6 md:p-8">
            <h1 class="text-3xl font-bold text-center text-blue-800 mb-6 flex items-center justify-center gap-2">
                <span class="lucide"></span> Ghoti - Hooked Logbook
            </h1>

            <form id="catch-form" class="mb-8 space-y-4">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Log a New Catch</h2>

                <div>
                    <label for="species" class="block text-sm font-medium text-gray-600 mb-1">Species:</label>
                    <input type="text" id="species" name="species" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="length" class="block text-sm font-medium text-gray-600 mb-1">Length (cm):</label>
                        <input type="number" id="length" name="length" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-600 mb-1">Weight (kg):</label>
                        <input type="number" id="weight" name="weight" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <div>
                    <label for="datetime" class="block text-sm font-medium text-gray-600 mb-1">Date & Time:</label>
                    <input type="datetime-local" id="datetime" name="datetime" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div>
                    <label for="notes" class="block text-sm font-medium text-gray-600 mb-1">Notes:</label>
                    <textarea id="notes" name="notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>

                <div class="border-t pt-4 space-y-2">
                     <label class="block text-sm font-medium text-gray-600">Location:</label>
                     <div class="flex items-center gap-4 flex-wrap">
                        <button type="button" id="get-location-btn" class="flex items-center gap-1 px-3 py-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-sm">
                            <span class="lucide"></span> Get Current Location
                        </button>
                        <span id="location-status" class="text-sm text-gray-500">Location not saved.</span>
                     </div>
                     <input type="hidden" id="latitude" name="latitude">
                     <input type="hidden" id="longitude" name="longitude">
                </div>

                <div>
                    <label for="location-name" class="block text-sm font-medium text-gray-600 mb-1">Location Name:</label>
                    <input type="text" id="location-name" name="location-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div>
                    <label for="photo" class="block text-sm font-medium text-gray-600 mb-1">Photo:</label>
                    <input type="file" id="photo" name="photo" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                 <div id="message-box" class="hidden p-3 rounded-md text-sm"></div>

                <button type="submit" class="w-full flex justify-center items-center gap-2 px-4 py-2 bg-green-600 text-white font-semibold rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                     <span class="lucide"></span> Save Catch
                </button>
            </form>

            <div>
                <div class="flex justify-between items-center border-b pb-2 mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">Catch History</h2>
                    <button id="back-to-landing-btn" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
                         <span class="lucide text-base"></span> Back to Home
                    </button>
                </div>
                <div id="catch-log" class="space-y-4">
                    <p class="text-gray-500 italic">No catches logged yet.</p>
                </div>
                 <button id="clear-log-btn" class="mt-6 px-4 py-2 bg-red-500 text-white font-semibold rounded-md shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 text-sm flex items-center gap-1 hidden">
                    <span class="lucide"></span> Clear All Logs
                </button>
                <div id="pagination-controls" class="flex justify-between mt-4">
                    <button id="prev-page-btn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400" disabled>Previous</button>
                    <button id="next-page-btn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400" disabled>Next</button>
                </div>
            </div>
        </div>
    </div>

    <div id="catch-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" data-modal-background>
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
            <button id="close-modal-btn" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
                ✖
            </button>
            <h3 id="modal-species" class="text-xl font-bold text-blue-700 mb-4"></h3>
            <p id="modal-date" class="text-sm text-gray-500 mb-2"></p>
            <p id="modal-length" class="text-sm text-gray-600 mb-2"></p>
            <p id="modal-weight" class="text-sm text-gray-600 mb-2"></p>
            <p id="modal-location" class="text-sm text-gray-600 mb-2"></p>
            <p id="modal-notes" class="text-sm text-gray-600 mb-4"></p>
            <img id="modal-photo" class="w-full h-auto rounded-md mb-4 hidden" alt="Catch Photo">
            <button id="delete-catch-btn" class="w-full px-4 py-2 bg-red-500 text-white font-semibold rounded-md shadow-md hover:bg-red-600">
                Delete Catch
            </button>
        </div>
    </div>

    <div id="loading-indicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="text-white text-lg">Loading...</div>
    </div>

    <script>
        // DOM Elements
        const landingPage = document.getElementById('landing-page');
        const appContent = document.getElementById('app-content');
        const enterAppBtn = document.getElementById('enter-app-btn');
        const backToLandingBtn = document.getElementById('back-to-landing-btn');

        const catchForm = document.getElementById('catch-form');
        const speciesInput = document.getElementById('species');
        const lengthInput = document.getElementById('length');
        const weightInput = document.getElementById('weight');
        const datetimeInput = document.getElementById('datetime');
        const notesInput = document.getElementById('notes');
        const getLocationBtn = document.getElementById('get-location-btn');
        const locationStatus = document.getElementById('location-status');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const catchLogContainer = document.getElementById('catch-log');
        const clearLogBtn = document.getElementById('clear-log-btn');
        const messageBox = document.getElementById('message-box');

        let currentPage = 0;
        const itemsPerPage = 5;

        // --- Navigation ---
        function showApp() {
            landingPage.classList.add('hidden');
            appContent.classList.remove('hidden');
            renderCatches();
            setDefaultDateTime();
        }

        function showLandingPage() {
            appContent.classList.add('hidden');
            landingPage.classList.remove('hidden');
        }

        // --- Utility Functions ---
        function showMessage(text, type = 'success') {
            messageBox.textContent = text;
            messageBox.className = `p-3 rounded-md text-sm ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        function formatDate(date) {
            if (!date || !(date instanceof Date)) return 'N/A';
            return date.toLocaleString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric',
                hour: 'numeric', minute: '2-digit', hour12: true
            });
        }

         function setDefaultDateTime() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const hh = String(now.getHours()).padStart(2, '0');
            const min = String(now.getMinutes()).padStart(2, '0');
            datetimeInput.value = `${yyyy}-${mm}-${dd}T${hh}:${min}`;
        }

        // --- Geolocation ---
        function handleGetLocation() {
            if (!navigator.geolocation) {
                locationStatus.textContent = 'Geolocation not supported.';
                locationStatus.classList.add('text-red-600');
                getLocationBtn.disabled = true;
                getLocationBtn.classList.add('btn-disabled');
                return;
            }

            locationStatus.textContent = 'Getting location...';
            locationStatus.classList.remove('text-red-600', 'text-green-600');
            getLocationBtn.disabled = true;
            getLocationBtn.classList.add('btn-disabled');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    latitudeInput.value = lat;
                    longitudeInput.value = lon;
                    locationStatus.textContent = `Location captured: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                    locationStatus.classList.add('text-green-600');
                    getLocationBtn.disabled = false;
                    getLocationBtn.classList.remove('btn-disabled');
                },
                (error) => {
                    let errorMsg = 'Unable to retrieve location.';
                    if (error.code === error.PERMISSION_DENIED) errorMsg = "Location access denied.";
                    else if (error.code === error.POSITION_UNAVAILABLE) errorMsg = "Location unavailable.";
                    else if (error.code === error.TIMEOUT) errorMsg = "Location request timed out.";

                    locationStatus.textContent = errorMsg;
                    locationStatus.classList.add('text-red-600');
                    latitudeInput.value = '';
                    longitudeInput.value = '';
                    getLocationBtn.disabled = false;
                    getLocationBtn.classList.remove('btn-disabled');
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }

        // --- Local Storage & Data Handling ---
        if (typeof localStorage === 'undefined' || localStorage === null) {
            alert('Local storage is not supported on this device. Data will not be saved.');
        }

        if (!window.indexedDB) {
            alert('Your browser does not support IndexedDB. Data will not be saved.');
        }

        function getCatches() {
            const catchesJSON = localStorage.getItem('ghotiFishingLogCatches');
            try {
                // Ensure catches are always returned as an array
                const parsed = catchesJSON ? JSON.parse(catchesJSON) : [];
                return Array.isArray(parsed) ? parsed : [];
            } catch (e) {
                console.error("Error parsing catches from localStorage:", e);
                 localStorage.removeItem('ghotiFishingLogCatches'); // Clear corrupted data
                return [];
            }
        }

        function saveCatches(catches) {
            // Ensure we are saving an array
             if (!Array.isArray(catches)) {
                console.error("Attempted to save non-array data to catches:", catches);
                return; // Prevent saving invalid data
            }
            try {
                // Sort catches by date descending before saving
                catches.sort((a, b) => {
                    const dateA = a.datetime ? new Date(a.datetime) : 0;
                    const dateB = b.datetime ? new Date(a.datetime) : 0;
                    return dateB - dateA;
                });
                localStorage.setItem('ghotiFishingLogCatches', JSON.stringify(catches));
            } catch (e) {
                console.error("Error saving catches to localStorage:", e);
                showMessage("Could not save catch data. Storage might be full.", 'error');
            }
        }


        function addCatch(event) {
            event.preventDefault();

            const locationNameInput = document.getElementById('location-name');
            const photoInput = document.getElementById('photo');

            // Convert photo to Base64 if a file is uploaded
            const photoFile = photoInput.files[0];
            const reader = new FileReader();

            reader.onload = function () {
                const newCatch = {
                    id: Date.now().toString(),
                    species: speciesInput.value.trim(),
                    length: lengthInput.value ? parseFloat(lengthInput.value) : null,
                    weight: weightInput.value ? parseFloat(weightInput.value) : null,
                    datetime: datetimeInput.value, // Stored as ISO string
                    notes: notesInput.value.trim(),
                    latitude: latitudeInput.value ? parseFloat(latitudeInput.value) : null,
                    longitude: longitudeInput.value ? parseFloat(longitudeInput.value) : null,
                    locationName: locationNameInput.value.trim() || null, // Custom location name
                    photo: reader.result || null, // Explicitly set to null if no photo is uploaded
                };

                if (!newCatch.species) {
                    speciesInput.classList.add('border-red-500');
                    showMessage("Species is required.", 'error');
                    return;
                } else {
                    speciesInput.classList.remove('border-red-500');
                }

                if (!newCatch.datetime) {
                    datetimeInput.classList.add('border-red-500');
                    showMessage("Date & Time are required.", 'error');
                    return;
                } else {
                    datetimeInput.classList.remove('border-red-500');
                }

                // Save to IndexedDB
                const request = indexedDB.open('FishingLogDB', 1);

                request.onsuccess = function (event) {
                    const db = event.target.result;
                    const transaction = db.transaction('catches', 'readwrite');
                    const store = transaction.objectStore('catches');

                    store.add(newCatch);

                    transaction.oncomplete = function () {
                        renderCatches(); // Refresh the catch history
                        catchForm.reset(); // Clear the form
                        setDefaultDateTime(); // Reset the date/time input
                        latitudeInput.value = ''; // Clear hidden location fields
                        longitudeInput.value = '';
                        locationStatus.textContent = 'Location not saved.'; // Reset location status text
                        locationStatus.classList.remove('text-green-600', 'text-red-600'); // Reset location status color
                        showMessage('Catch logged successfully!', 'success');
                    };

                    transaction.onerror = function (event) {
                        console.error('Failed to save catch:', event.target.error);
                        showMessage('Failed to save catch. Please try again.', 'error');
                    };
                };

                request.onerror = function (event) {
                    console.error('Failed to open IndexedDB:', event.target.error);
                    showMessage('Database error. Please refresh the page.', 'error');
                };
            };

            if (photoFile) {
                reader.readAsDataURL(photoFile);
            } else {
                reader.onload(); // Trigger the function even if no photo is uploaded
            }
        }


        function deleteCatch(id) {
             // Ensure ID is a string for comparison
            const idToDelete = String(id);
            if (confirm("Are you sure you want to delete this catch?")) {
                let catches = getCatches();
                // Filter out the catch with the matching ID
                catches = catches.filter(c => String(c.id) !== idToDelete);
                saveCatches(catches); // Save the updated array
                renderCatches(); // Update the UI
                showMessage('Catch deleted.', 'success');
            }
        }


        function clearAllLogs() {
            const confirmation = confirm("Are you sure you want to delete ALL logged catches? This cannot be undone.");
            if (confirmation) {
                const request = indexedDB.open('FishingLogDB', 1);

                request.onsuccess = function (event) {
                    const db = event.target.result;
                    const transaction = db.transaction('catches', 'readwrite');
                    const store = transaction.objectStore('catches');
                    const clearRequest = store.clear();

                    clearRequest.onsuccess = function () {
                        renderCatches(); // Refresh the UI
                        showMessage('All catches cleared.', 'success');
                    };

                    clearRequest.onerror = function (event) {
                        console.error('Failed to clear logs:', event.target.error);
                        showMessage('Failed to clear logs. Please try again.', 'error');
                    };
                };
            }
        }


        // --- Rendering ---
        function showLoading() {
            document.getElementById('loading-indicator').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-indicator').classList.add('hidden');
        }

        function renderCatchesUI(catches) {
            catchLogContainer.innerHTML = ''; // Clear previous entries

            if (catches.length === 0) {
                catchLogContainer.innerHTML = '<p class="text-gray-500 italic">No catches logged yet.</p>';
                return;
            }

            catches.forEach(c => {
                const catchElement = document.createElement('div');
                catchElement.className = 'p-4 border border-gray-200 rounded-lg shadow-sm bg-white relative hover:shadow-md transition-shadow duration-150 cursor-pointer';

                // Render catch details
                catchElement.innerHTML = `
                    <h3 class="text-lg font-semibold text-blue-700">${c.species || 'Unknown Species'}</h3>
                    <p class="text-sm text-gray-500"><strong>Date:</strong> ${formatDate(new Date(c.datetime))}</p>
                `;

                // Add click event to open modal
                catchElement.addEventListener('click', () => {
                    openCatchModal(c);
                });

                catchLogContainer.appendChild(catchElement);
            });
        }

        function renderCatches(page = 0) {
            const request = indexedDB.open('FishingLogDB', 1);

            request.onsuccess = function (event) {
                const db = event.target.result;
                const transaction = db.transaction('catches', 'readonly');
                const store = transaction.objectStore('catches');
                const getAllRequest = store.getAll();

                getAllRequest.onsuccess = function () {
                    const catches = getAllRequest.result;
                    const totalPages = Math.ceil(catches.length / itemsPerPage);
                    const start = page * itemsPerPage;
                    const end = start + itemsPerPage;
                    const paginatedCatches = catches.slice(start, end);

                    renderCatchesUI(paginatedCatches); // Render only the current page

                    // Update pagination controls
                    document.getElementById('prev-page-btn').disabled = page === 0;
                    document.getElementById('next-page-btn').disabled = page >= totalPages - 1;
                };
            };
        }

        // Event listeners for pagination buttons
        document.getElementById('prev-page-btn').addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                renderCatches(currentPage);
            }
        });

        document.getElementById('next-page-btn').addEventListener('click', () => {
            currentPage++;
            renderCatches(currentPage);
        });

        function openCatchModal(catchData) {
            const modal = document.getElementById('catch-modal');
            modal.classList.remove('hidden');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling

            // Focus the close button
            document.getElementById('close-modal-btn').focus();

            // Trap focus within the modal
            modal.addEventListener('keydown', (event) => {
                if (event.key === 'Tab') {
                    const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                    const firstElement = focusableElements[0];
                    const lastElement = focusableElements[focusableElements.length - 1];

                    if (event.shiftKey && document.activeElement === firstElement) {
                        lastElement.focus();
                        event.preventDefault();
                    } else if (!event.shiftKey && document.activeElement === lastElement) {
                        firstElement.focus();
                        event.preventDefault();
                    }
                } else if (event.key === 'Escape') {
                    closeCatchModal();
                }
            });
        }

        function closeCatchModal() {
            const modal = document.getElementById('catch-modal');
            modal.classList.add('hidden');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = ''; // Restore background scrolling
        }

        // Close modal when clicking outside the modal content
        document.getElementById('catch-modal').addEventListener('click', (event) => {
            if (event.target.getAttribute('data-modal-background') !== null) {
                closeCatchModal();
            }
        });

        function resizeImage(file, maxWidth, maxHeight, callback) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth || height > maxHeight) {
                        if (width > height) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        } else {
                            width *= maxHeight / height;
                            height = maxHeight;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    callback(canvas.toDataURL('image/jpeg', 0.8)); // Adjust quality as needed
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // --- Event Listeners ---
        enterAppBtn.addEventListener('click', showApp);
        enterAppBtn.addEventListener('touchstart', showApp);
        backToLandingBtn.addEventListener('click', showLandingPage);
        catchForm.addEventListener('submit', addCatch);
        getLocationBtn.addEventListener('click', handleGetLocation);
        clearLogBtn.addEventListener('click', clearAllLogs);
        document.getElementById('close-modal-btn').addEventListener('click', closeCatchModal);

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
             // Check if there are logs to potentially show the clear button immediately
             // This handles cases where the user might reload the page while on the app view
             if (getCatches().length > 0) {
                clearLogBtn.classList.remove('hidden');
            }
             // If app-content is already visible (e.g., after reload), render catches
             if (!appContent.classList.contains('hidden')) {
                 renderCatches();
                 setDefaultDateTime(); // Also set default time if app is visible
             }
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(() => {
                console.log('Service Worker registered successfully.');
            }).catch(error => {
                console.error('Service Worker registration failed:', error);
            });
        }

        // Open IndexedDB
        const request = indexedDB.open('FishingLogDB', 1);

        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('catches')) {
                db.createObjectStore('catches', { keyPath: 'id' });
            }
        };

        request.onsuccess = function(event) {
            const db = event.target.result;

            // Example: Add a catch
            const transaction = db.transaction('catches', 'readwrite');
            const store = transaction.objectStore('catches');
            store.add({
                id: Date.now(),
                species: 'Bass',
                length: 30,
                weight: 2.5,
                datetime: new Date().toISOString(),
                notes: 'Caught near the dock.',
                latitude: 40.7128,
                longitude: -74.0060
            });

            transaction.oncomplete = function() {
                console.log('Catch saved to IndexedDB!');
            };

            transaction.onerror = function (event) {
                console.error('Failed to save catch:', event.target.error);
                showMessage('Failed to save catch. Please try again.', 'error');
            };
        };

        request.onerror = function (event) {
            console.error('Failed to open IndexedDB:', event.target.error);
            showMessage('Database error. Please refresh the page.', 'error');
        };
    </script>

</body>
</html>
